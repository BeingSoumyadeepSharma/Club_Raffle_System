(()=>{var e={};e.id=240,e.ids=[240],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9377:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>h,pages:()=>o,routeModule:()=>x,tree:()=>d});var t=a(9441),r=a(1498),n=a(6580),l=a.n(n),i=a(5511),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);a.d(s,c);let d=["",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,1160)),"/Users/soumyadeepsharma99/Desktop/Dev/Raffle_GodFather/packages/frontend/src/app/users/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,4831)),"/Users/soumyadeepsharma99/Desktop/Dev/Raffle_GodFather/packages/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,3250,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/soumyadeepsharma99/Desktop/Dev/Raffle_GodFather/packages/frontend/src/app/users/page.tsx"],h="/users/page",u={require:a,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/users/page",pathname:"/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4027:(e,s,a)=>{Promise.resolve().then(a.bind(a,8185))},461:(e,s,a)=>{"use strict";a.d(s,{Z:()=>t});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(7879).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8185:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>E});var t=a(7685),r=a(3810),n=a(7986),l=a(7063),i=a(3920),c=a(4283),d=a(4887),o=a(7869),h=a(5090),u=a(4177),x=a(5944),m=a(9709),p=a(1964),f=a(9997),g=a(1099),j=a(7879);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,j.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var N=a(4150);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let v=(0,j.Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);var w=a(5943),b=a(461),k=a(4654),C=a(9881);let _=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3000/api",S={superuser:{variant:"default",icon:t.jsx(m.Z,{className:"h-3 w-3"})},club_owner:{variant:"default",icon:t.jsx(p.Z,{className:"h-3 w-3"})},event_manager:{variant:"secondary",icon:t.jsx(f.Z,{className:"h-3 w-3"})},staff:{variant:"outline",icon:t.jsx(g.Z,{className:"h-3 w-3"})}},P={superuser:4,club_owner:3,event_manager:2,staff:1};function E(){let{user:e,isLoading:s,canManageUsers:a}=(0,l.useAuth)(),m=(0,n.useRouter)(),[p,f]=(0,r.useState)([]),[g,j]=(0,r.useState)([]),[E,A]=(0,r.useState)(!0),[$,q]=(0,r.useState)([]),[F,Z]=(0,r.useState)(!1),[L,R]=(0,r.useState)(""),[U,z]=(0,r.useState)(""),[O,T]=(0,r.useState)("staff"),[D,H]=(0,r.useState)(""),[B,M]=(0,r.useState)(!1),[G,I]=(0,r.useState)(!1),[V,K]=(0,r.useState)(null),[J,Q]=(0,r.useState)(""),[X,Y]=(0,r.useState)(!1),[W,ee]=(0,r.useState)(null),[es,ea]=(0,r.useState)(""),[et,er]=(0,r.useState)(!1),[en,el]=(0,r.useState)(null),[ei,ec]=(0,r.useState)("");(0,r.useEffect)(()=>{s||e?s||!e||a()||m.push("/"):m.push("/login")},[e,s,m,a]),(0,r.useEffect)(()=>{e&&a()&&(ed(),eo(),eh())},[e]);let ed=async()=>{try{let e=await fetch(`${_}/auth/users`,{headers:(0,l.getAuthHeaders)()}),s=await e.json();s.success&&f(s.data)}catch(e){console.error("Failed to load users:",e)}finally{A(!1)}},eo=async()=>{j(await (0,C.uc)())},eh=async()=>{try{let e=await fetch(`${_}/auth/roles/creatable`,{headers:(0,l.getAuthHeaders)()}),s=await e.json();s.success&&(q(s.data),s.data.length>0&&T(s.data[s.data.length-1]))}catch(e){console.error("Failed to load creatable roles:",e)}},eu=async e=>{e.preventDefault(),M(!0);try{let e=await fetch(`${_}/auth/users`,{method:"POST",headers:{"Content-Type":"application/json",...(0,l.getAuthHeaders)()},body:JSON.stringify({username:L,password:U,role:O,rafflerName:D||void 0})}),s=await e.json();s.success?(Z(!1),R(""),z(""),H(""),T($[$.length-1]||"staff"),ed()):alert(s.error||"Failed to create user")}catch(e){console.error("Failed to create user:",e),alert("Failed to create user")}finally{M(!1)}},ex=async e=>{if(confirm("Are you sure you want to delete this user?"))try{let s=await fetch(`${_}/auth/users/${e}`,{method:"DELETE",headers:(0,l.getAuthHeaders)()});if(s.ok)ed();else{let e=await s.json();alert(e.error||"Failed to delete user")}}catch(e){console.error("Failed to delete user:",e)}},em=s=>!!e&&s.id!==e.id&&P[e.role]>P[s.role],ep=async()=>{if(V&&J)try{let e=await fetch(`${_}/auth/users/${V}/entities`,{method:"POST",headers:{"Content-Type":"application/json",...(0,l.getAuthHeaders)()},body:JSON.stringify({entityId:J})});if(e.ok)I(!1),K(null),Q(""),ed();else{let s=await e.json();alert(s.error||"Failed to assign entity")}}catch(e){console.error("Failed to assign entity:",e)}},ef=async(e,s)=>{try{(await fetch(`${_}/auth/users/${e}/entities/${s}`,{method:"DELETE",headers:(0,l.getAuthHeaders)()})).ok&&ed()}catch(e){console.error("Failed to unassign entity:",e)}},eg=async()=>{if(W&&es)try{let e=await fetch(`${_}/auth/users/${W}/password`,{method:"PATCH",headers:{"Content-Type":"application/json",...(0,l.getAuthHeaders)()},body:JSON.stringify({password:es})});if(e.ok)Y(!1),ee(null),ea(""),alert("Password updated successfully");else{let s=await e.json();alert(s.error||"Failed to update password")}}catch(e){console.error("Failed to update password:",e)}},ej=async()=>{if(en)try{let e=await fetch(`${_}/auth/users/${en}/raffler-name`,{method:"PATCH",headers:{"Content-Type":"application/json",...(0,l.getAuthHeaders)()},body:JSON.stringify({rafflerName:ei})});if(e.ok)er(!1),el(null),ec(""),ed();else{let s=await e.json();alert(s.error||"Failed to update raffler name")}}catch(e){console.error("Failed to update raffler name:",e)}},ey=e=>{let s=g.find(s=>s.id===e);return s?`${s.emoji} ${s.displayName}`:e};return s||!a()?t.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:t.jsx("p",{className:"text-muted-foreground",children:"Loading..."})}):(0,t.jsxs)("div",{className:"space-y-6 md:space-y-8",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),t.jsx("p",{className:"text-muted-foreground text-sm sm:text-base",children:"Create users and assign them to club entities"})]}),(0,t.jsxs)(u.Vq,{open:F,onOpenChange:Z,children:[t.jsx(u.hg,{asChild:!0,children:(0,t.jsxs)(c.z,{className:"gap-2 w-full sm:w-auto",children:[t.jsx(y,{className:"h-4 w-4"}),"Create User"]})}),(0,t.jsxs)(u.cZ,{children:[(0,t.jsxs)(u.fK,{children:[t.jsx(u.$N,{children:"Create New User"}),t.jsx(u.Be,{children:"Create a new user account and assign a role."})]}),(0,t.jsxs)("form",{onSubmit:eu,children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o._,{children:"Username"}),t.jsx(d.I,{value:L,onChange:e=>R(e.target.value),placeholder:"Enter username",required:!0})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o._,{children:"Password"}),t.jsx(d.I,{type:"password",value:U,onChange:e=>z(e.target.value),placeholder:"Enter password (min 4 characters)",minLength:4,required:!0})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o._,{children:"Raffler Name (Optional)"}),t.jsx(d.I,{value:D,onChange:e=>H(e.target.value),placeholder:"Name used for raffle entries"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"This name will auto-fill when purchasing tickets or making announcements"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[t.jsx(o._,{children:"Role"}),(0,t.jsxs)(x.Ph,{value:O,onValueChange:e=>T(e),children:[t.jsx(x.i4,{children:t.jsx(x.ki,{placeholder:"Select a role"})}),t.jsx(x.Bw,{children:$.map(e=>t.jsx(x.Ql,{value:e,children:l.ROLE_LABELS[e]},e))})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["superuser"===O&&"Full access to all clubs and user management","club_owner"===O&&"Can edit club info and manage Event Managers & Staff","event_manager"===O&&"Can edit club info and manage Staff","staff"===O&&"Basic access to assigned clubs"]})]})]}),t.jsx(u.cN,{children:t.jsx(c.z,{type:"submit",disabled:B||0===$.length,children:B?"Creating...":"Create User"})})]})]})]})]}),E?t.jsx("p",{className:"text-muted-foreground",children:"Loading users..."}):0===p.length?t.jsx(i.Zb,{className:"p-6 sm:p-8 text-center",children:t.jsx("p",{className:"text-muted-foreground",children:"No users found."})}):t.jsx("div",{className:"grid gap-3 sm:gap-4",children:p.map(s=>(0,t.jsxs)(i.Zb,{children:[(0,t.jsxs)(i.Ol,{className:"pb-2 p-3 sm:p-6 sm:pb-2",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,t.jsxs)(i.ll,{className:"text-base sm:text-lg flex flex-wrap items-center gap-2",children:[s.username,(0,t.jsxs)(h.C,{variant:S[s.role].variant,className:"gap-1 text-xs",children:[S[s.role].icon,l.ROLE_LABELS[s.role]]})]}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[s.id===e?.id&&(0,t.jsxs)(c.z,{variant:"outline",size:"sm",className:"gap-1 text-xs sm:text-sm",onClick:()=>{el(s.id),ec(s.rafflerName||""),er(!0)},children:[t.jsx(N.Z,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Raffler Name"})]}),(s.id===e?.id||em(s))&&(0,t.jsxs)(c.z,{variant:"outline",size:"sm",className:"gap-1 text-xs sm:text-sm",onClick:()=>{ee(s.id),Y(!0)},children:[t.jsx(v,{className:"h-4 w-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Password"})]}),em(s)&&t.jsx(c.z,{variant:"outline",size:"sm",className:"gap-1 text-red-500 hover:bg-red-500/10",onClick:()=>ex(s.id),children:t.jsx(w.Z,{className:"h-4 w-4"})}),s.id===e?.id&&t.jsx(h.C,{variant:"outline",className:"text-xs",children:"You"})]})]}),(0,t.jsxs)(i.SZ,{className:"text-xs sm:text-sm",children:["Created: ",new Date(s.createdAt).toLocaleDateString(),s.rafflerName&&(0,t.jsxs)("span",{className:"ml-2",children:["â€¢ Raffler: ",s.rafflerName]})]})]}),(0,t.jsxs)(i.aY,{className:"p-3 pt-0 sm:p-6 sm:pt-0",children:["superuser"!==s.role&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[t.jsx(o._,{children:"Assigned Entities:"}),em(s)&&(0,t.jsxs)(c.z,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{K(s.id),I(!0)},children:[t.jsx(b.Z,{className:"h-4 w-4"}),"Assign Entity"]})]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:0===s.assignedEntities.length?t.jsx("span",{className:"text-sm text-muted-foreground",children:"No entities assigned"}):s.assignedEntities.map(e=>(0,t.jsxs)(h.C,{variant:"secondary",className:"gap-1 pr-1",children:[ey(e),em(s)&&t.jsx(c.z,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-destructive/20",onClick:()=>ef(s.id,e),children:t.jsx(k.Z,{className:"h-3 w-3"})})]},e))})]}),"superuser"===s.role&&t.jsx("p",{className:"text-sm text-muted-foreground",children:"Superusers have access to all entities"})]})]},s.id))}),t.jsx(u.Vq,{open:G,onOpenChange:I,children:(0,t.jsxs)(u.cZ,{children:[(0,t.jsxs)(u.fK,{children:[t.jsx(u.$N,{children:"Assign Entity"}),t.jsx(u.Be,{children:"Select an entity to assign to this user."})]}),t.jsx("div",{className:"py-4",children:(0,t.jsxs)(x.Ph,{value:J,onValueChange:Q,children:[t.jsx(x.i4,{children:t.jsx(x.ki,{placeholder:"Select an entity"})}),t.jsx(x.Bw,{children:g.map(e=>(0,t.jsxs)(x.Ql,{value:e.id,children:[e.emoji," ",e.displayName]},e.id))})]})}),t.jsx(u.cN,{children:t.jsx(c.z,{onClick:ep,disabled:!J,children:"Assign"})})]})}),t.jsx(u.Vq,{open:X,onOpenChange:Y,children:(0,t.jsxs)(u.cZ,{children:[(0,t.jsxs)(u.fK,{children:[t.jsx(u.$N,{children:"Update Password"}),t.jsx(u.Be,{children:"Enter a new password for this user."})]}),(0,t.jsxs)("div",{className:"py-4",children:[t.jsx(o._,{children:"New Password"}),t.jsx(d.I,{type:"password",value:es,onChange:e=>ea(e.target.value),placeholder:"Enter new password (min 4 characters)",minLength:4})]}),t.jsx(u.cN,{children:t.jsx(c.z,{onClick:eg,disabled:es.length<4,children:"Update Password"})})]})}),t.jsx(u.Vq,{open:et,onOpenChange:er,children:(0,t.jsxs)(u.cZ,{children:[(0,t.jsxs)(u.fK,{children:[t.jsx(u.$N,{children:"Update Raffler Name"}),t.jsx(u.Be,{children:"This name will auto-fill when purchasing tickets or making announcements."})]}),(0,t.jsxs)("div",{className:"py-4",children:[t.jsx(o._,{children:"Raffler Name"}),t.jsx(d.I,{value:ei,onChange:e=>ec(e.target.value),placeholder:"Enter your name for raffle entries"})]}),t.jsx(u.cN,{children:t.jsx(c.z,{onClick:ej,children:"Update Raffler Name"})})]})})]})}},1160:(e,s,a)=>{"use strict";a.r(s),a.d(s,{$$typeof:()=>n,__esModule:()=>r,default:()=>l});let t=(0,a(599).createProxy)(String.raw`/Users/soumyadeepsharma99/Desktop/Dev/Raffle_GodFather/packages/frontend/src/app/users/page.tsx`),{__esModule:r,$$typeof:n}=t,l=t.default}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[615,339,87,649,216],()=>a(9377));module.exports=t})();