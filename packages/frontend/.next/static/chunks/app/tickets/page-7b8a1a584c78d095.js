(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{4047:function(e,s,t){Promise.resolve().then(t.bind(t,8524))},8524:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return _}});var a=t(7573),l=t(7653),i=t(2859),n=t(9554),r=t(3925),c=t(747),d=t(6120),o=t(6801),m=t(3061);let x=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("textarea",{className:(0,m.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});x.displayName="Textarea";var u=t(8151),h=t(8137),f=t(8314),j=t(6994),p=t(5592),g=t(9375),N=t(3484),v=t(8046);function b(e){let{entities:s,onCounterReset:t}=e,{user:i}=(0,v.useAuth)(),[n,r]=(0,l.useState)(!1),[m,b]=(0,l.useState)(!1),[w,y]=(0,l.useState)(""),[k,S]=(0,l.useState)(""),[C,T]=(0,l.useState)("100"),[F,Z]=(0,l.useState)(""),[E,A]=(0,l.useState)(!1);(0,l.useEffect)(()=>{var e;if((null==i?void 0:i.rafflerName)&&S(i.rafflerName),!w&&(null==i?void 0:null===(e=i.assignedEntities)||void 0===e?void 0:e.length)){let e=s.find(e=>i.assignedEntities.includes(e.id));e&&y(e.id)}},[i,s,w]);let R=async()=>{if(w&&k&&C){b(!0);try{let e=await (0,f.Un)({entityId:w,rafflerName:k,pricePerTicket:parseFloat(C)});e&&Z(e)}catch(e){console.error("Failed to generate announcement:",e)}finally{b(!1)}}},z=async()=>{await navigator.clipboard.writeText(F),A(!0),setTimeout(()=>A(!1),2e3)},P=async()=>{if(w&&confirm("Are you sure you want to reset the ticket counter? This will start ticket numbers from 1 again.")){b(!0);try{await (0,f.qu)(w)&&(alert("Ticket counter has been reset to 0!"),null==t||t())}catch(e){console.error("Failed to reset counter:",e)}finally{b(!1)}}};return s.find(e=>e.id===w),(0,a.jsxs)(u.Vq,{open:n,onOpenChange:r,children:[(0,a.jsx)(u.hg,{asChild:!0,children:(0,a.jsxs)(c.z,{variant:"outline",className:"gap-2",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),"Announcement"]})}),(0,a.jsxs)(u.cZ,{className:"sm:max-w-[500px]",children:[(0,a.jsxs)(u.fK,{children:[(0,a.jsx)(u.$N,{children:"Generate Raffle Announcement"}),(0,a.jsx)(u.Be,{children:"Create an announcement with current stats and prize amount (70% of revenue)"})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o._,{htmlFor:"entity",children:"Club Entity"}),(0,a.jsxs)(h.Ph,{value:w,onValueChange:y,children:[(0,a.jsx)(h.i4,{children:(0,a.jsx)(h.ki,{placeholder:"Select a club"})}),(0,a.jsx)(h.Bw,{children:s.map(e=>(0,a.jsxs)(h.Ql,{value:e.id,children:[e.emoji," ",e.displayName]},e.id))})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o._,{htmlFor:"rafflerName",children:"Your Name (Raffler)"}),(0,a.jsx)(d.I,{id:"rafflerName",value:k,onChange:e=>S(e.target.value),placeholder:"Enter your name"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o._,{htmlFor:"pricePerTicket",children:"Price per Ticket ($)"}),(0,a.jsx)(d.I,{id:"pricePerTicket",type:"number",min:"0",step:"1",value:C,onChange:e=>T(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.z,{onClick:R,disabled:m||!w||!k,className:"flex-1",children:"Generate Announcement"}),(0,a.jsxs)(c.z,{variant:"destructive",onClick:P,disabled:m||!w,className:"gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),"Reset Counter"]})]}),F&&(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o._,{children:"Generated Announcement"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x,{value:F,readOnly:!0,className:"min-h-[120px] pr-12"}),(0,a.jsx)(c.z,{size:"icon",variant:"ghost",className:"absolute top-2 right-2",onClick:z,children:E?(0,a.jsx)(g.Z,{className:"h-4 w-4 text-green-500"}):(0,a.jsx)(N.Z,{className:"h-4 w-4"})})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click the copy button to copy the announcement to your clipboard."})]})]}),(0,a.jsx)(u.cN,{children:(0,a.jsx)(c.z,{variant:"outline",onClick:()=>r(!1),children:"Close"})})]})]})}var w=t(2591),y=t(44),k=t(999),S=t(4186),C=t(8967),T=t(6302),F=t(5453),Z=t(8869),E=t(8053);function A(e){let{entityId:s,entityName:t,activeSession:i,onSessionChange:n}=e,[r,d]=(0,l.useState)(!1),[o,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),j=async()=>{d(!0),h(null);try{await (0,f.yj)(s),n()}catch(e){h(e.message||"Failed to start session")}finally{d(!1)}},p=async()=>{if(i){d(!0),h(null);try{await (0,f.RJ)(i.id),m(!1),n()}catch(e){h(e.message||"Failed to close session")}finally{d(!1)}}},g=e=>{let s=new Date(e),t=new Date().getTime()-s.getTime(),a=Math.floor(t/36e5),l=Math.floor(t%36e5/6e4);return a>0?"".concat(a,"h ").concat(l,"m"):"".concat(l,"m")};return i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(k.Zb,{className:"border-green-500/50 bg-green-500/5",children:[(0,a.jsx)(k.Ol,{className:"pb-2 p-3 sm:p-6 sm:pb-2",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)(y.C,{variant:"default",className:"bg-green-500",children:[(0,a.jsx)(C.Z,{className:"h-3 w-3 mr-1"}),"Active Shift"]}),(0,a.jsxs)("span",{className:"text-xs sm:text-sm text-muted-foreground",children:["Started ",g(i.startedAt)," ago"]})]}),(0,a.jsxs)(c.z,{variant:"destructive",size:"sm",onClick:()=>m(!0),className:"gap-2 w-full sm:w-auto",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4"}),"End Shift"]})]})}),(0,a.jsxs)(k.aY,{className:"p-3 pt-0 sm:p-6 sm:pt-0",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(F.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Raffler"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:i.username})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Tickets Sold"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:i.ticketsSold})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Revenue"}),(0,a.jsxs)("p",{className:"text-sm font-medium",children:["$",i.totalRevenue.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Started"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:new Date(i.startedAt).toLocaleTimeString()})]})]})]}),x&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-2",children:x})]})]}),(0,a.jsx)(u.Vq,{open:o,onOpenChange:m,children:(0,a.jsxs)(u.cZ,{children:[(0,a.jsxs)(u.fK,{children:[(0,a.jsx)(u.$N,{children:"End Shift?"}),(0,a.jsxs)(u.Be,{children:["Are you sure you want to end this shift for ",t,"?"]})]}),(0,a.jsxs)("div",{className:"py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Duration"}),(0,a.jsx)("p",{className:"font-medium",children:g(i.startedAt)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Tickets Sold"}),(0,a.jsx)("p",{className:"font-medium",children:i.ticketsSold})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Total Revenue"}),(0,a.jsxs)("p",{className:"font-medium",children:["$",i.totalRevenue.toFixed(2)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Ticket Range"}),(0,a.jsxs)("p",{className:"font-medium",children:[i.startTicketNumber," - ",i.endTicketNumber||i.startTicketNumber-1]})]})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-4",children:"After ending the shift, you can start a new one. The ticket counter will reset for the next shift."})]}),(0,a.jsxs)(u.cN,{children:[(0,a.jsx)(c.z,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),(0,a.jsx)(c.z,{variant:"destructive",onClick:p,disabled:r,children:r?"Ending...":"End Shift"})]})]})})]}):(0,a.jsx)(k.Zb,{className:"border-dashed",children:(0,a.jsxs)(k.aY,{className:"pt-4 sm:pt-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"No active shift"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Start a shift to begin selling tickets. The ticket counter will reset."})]}),(0,a.jsxs)(c.z,{onClick:j,disabled:r,className:"gap-2 w-full sm:w-auto",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4"}),r?"Starting...":"Start Shift"]})]}),x&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-2",children:x})]})})}var R=t(1583);let z=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(R.fC,{className:(0,m.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...l,ref:s,children:(0,a.jsx)(R.bU,{className:(0,m.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});z.displayName=R.fC.displayName;var P=t(3062),D=t(5924);function _(){let[e,s]=(0,l.useState)([]),[t,d]=(0,l.useState)([]),[m,x]=(0,l.useState)(""),[u,j]=(0,l.useState)(null),[p,g]=(0,l.useState)(!0),[N,y]=(0,l.useState)(""),[S,C]=(0,l.useState)(!1),[T,F]=(0,l.useState)(!0),[Z,E]=(0,l.useState)(!1),{user:R,isLoading:_}=(0,v.useAuth)(),$=(0,i.useRouter)();(0,l.useEffect)(()=>{_||R||$.push("/login")},[R,_,$]);let O=async()=>{let e=await (0,f.uc)();return s(e),e},V=async e=>{if("all"===e)return j(null),null;let s=await (0,f.s$)(e);return j(s),s},G=async function(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];F(!0);try{if("all"===e){let e=await (0,f.GP)();d(e)}else{let t=await (0,f.FJ)(e,{sessionOnly:s});d(t)}}catch(e){console.error("Failed to load purchases:",e)}finally{F(!1)}},U=async()=>{try{let e=await O(),s="all";if(R&&"superuser"!==R.role&&R.assignedEntities.length>0){let t=R.assignedEntities.find(s=>e.some(e=>e.id===s));t&&(s=t)}if(x(s),E(!0),"all"!==s)await V(s),await G(s,p);else{let e=await (0,f.GP)();d(e),F(!1)}}catch(e){console.error("Failed to load data:",e),F(!1)}};(0,l.useEffect)(()=>{R&&U()},[R]);let B=async e=>{x(e),await V(e),await G(e,p&&"all"!==e)},I=async e=>{g(e),"all"!==m&&await G(m,e)},L=async()=>{"all"!==m&&(await V(m),await G(m,p))},Q=e=>{y(e),C(!0),"all"!==m?(V(m),G(m,p)):U()},Y=t.reduce((e,s)=>e+s.ticketCount,0),q=t.reduce((e,s)=>e+s.totalPrice,0),M=e.find(e=>e.id===m);return _||!R||!Z||T&&0===e.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-[60vh]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDF9F️"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}):(0,a.jsxs)("div",{className:"space-y-6 md:space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Ticket Purchases"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm sm:text-base",children:"View and manage all ticket purchases"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(b,{entities:e,onCounterReset:U}),(0,a.jsx)(c.z,{variant:"outline",className:"gap-2 flex-1 sm:flex-none",asChild:!0,children:(0,a.jsxs)("a",{href:(0,f.mz)(),download:!0,children:[(0,a.jsx)(P.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden xs:inline",children:"Export"})]})}),(0,a.jsx)(r.U,{entities:e,onSuccess:Q})]})]}),(0,a.jsxs)("div",{className:"grid gap-3 sm:gap-4 grid-cols-2 md:grid-cols-4",children:[(0,a.jsxs)(k.Zb,{className:"p-3 sm:p-4",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Total Purchases"}),(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold",children:t.length})]}),(0,a.jsxs)(k.Zb,{className:"p-3 sm:p-4",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Tickets Sold"}),(0,a.jsx)("p",{className:"text-xl sm:text-2xl font-bold",children:Y})]}),(0,a.jsxs)(k.Zb,{className:"p-3 sm:p-4",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Revenue"}),(0,a.jsxs)("p",{className:"text-xl sm:text-2xl font-bold",children:["$",q.toFixed(2)]})]}),(0,a.jsxs)(k.Zb,{className:"p-3 sm:p-4 bg-gradient-to-r from-amber-500/10 to-yellow-500/10 border-amber-500/50",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"\uD83C\uDFC6 Prize (70%)"}),(0,a.jsxs)("p",{className:"text-xl sm:text-2xl font-bold text-amber-500",children:["$",Math.floor(.7*q).toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Filter by Club:"}),(0,a.jsxs)(h.Ph,{value:m,onValueChange:B,children:[(0,a.jsx)(h.i4,{className:"w-full sm:w-[250px]",children:(0,a.jsx)(h.ki,{placeholder:"Select a club"})}),(0,a.jsxs)(h.Bw,{children:[(null==R?void 0:R.role)==="superuser"&&(0,a.jsx)(h.Ql,{value:"all",children:"All Clubs"}),e.map(e=>(0,a.jsxs)(h.Ql,{value:e.id,children:[e.emoji," ",e.displayName]},e.id))]})]})]}),"all"!==m&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(z,{id:"session-toggle",checked:p,onCheckedChange:I}),(0,a.jsxs)(o._,{htmlFor:"session-toggle",className:"flex items-center gap-1 text-xs sm:text-sm cursor-pointer",children:[(0,a.jsx)(D.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:p?"Current session only":"Show all history"}),(0,a.jsx)("span",{className:"sm:hidden",children:p?"Session":"All"})]})]})]}),"all"!==m&&M&&(0,a.jsx)(A,{entityId:m,entityName:M.displayName,activeSession:u,onSessionChange:L})]}),T?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):0===t.length?(0,a.jsxs)(k.Zb,{className:"p-12 text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDF9F️"}),(0,a.jsx)("h3",{className:"text-lg sm:text-xl font-semibold mb-2",children:"all"!==m&&u&&p?"No Purchases in Current Session":"all"===m||u?"No Purchases Yet":"No Active Session"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:"all"===m||u?"Start selling raffle tickets to see purchases here.":"Start a shift to begin selling tickets."}),("all"===m||u)&&(0,a.jsx)(r.U,{entities:e,onSuccess:Q})]}):(0,a.jsx)("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:t.map(s=>(0,a.jsx)(n.Q,{purchase:s,entity:e.find(e=>e.id===s.entityId),onViewReceipt:e=>{y(e),C(!0)},onDelete:()=>{"all"!==m?(V(m),G(m,p)):U()},onUpdate:()=>{"all"!==m?(V(m),G(m,p)):U()}},s.id))}),(0,a.jsx)(w.$,{receipt:N,open:S,onOpenChange:C})]})}}},function(e){e.O(0,[801,136,284,144,73,540,228,293,16,744],function(){return e(e.s=4047)}),_N_E=e.O()}]);