(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{7781:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(4788).Z)("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]])},5950:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(4788).Z)("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]])},7917:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(4788).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6469:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(4788).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},2151:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(4788).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},8058:function(e,s,a){Promise.resolve().then(a.bind(a,952))},952:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return _}});var t=a(7573),r=a(7653),n=a(2859),l=a(8046),i=a(999),c=a(747),d=a(6120),o=a(6801),u=a(44),h=a(8151),m=a(8137),x=a(5950),p=a(6469),f=a(7781),j=a(2151),g=a(4788);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,g.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),N=(0,g.Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);var w=a(8073),v=a(7917),b=a(7342),k=a(8314);let C=a(4850).env.NEXT_PUBLIC_API_URL||"http://localhost:3000/api",S={superuser:{variant:"default",icon:(0,t.jsx)(x.Z,{className:"h-3 w-3"})},club_owner:{variant:"default",icon:(0,t.jsx)(p.Z,{className:"h-3 w-3"})},event_manager:{variant:"secondary",icon:(0,t.jsx)(f.Z,{className:"h-3 w-3"})},staff:{variant:"outline",icon:(0,t.jsx)(j.Z,{className:"h-3 w-3"})}},Z={superuser:4,club_owner:3,event_manager:2,staff:1};function _(){let{user:e,isLoading:s,canManageUsers:a}=(0,l.useAuth)(),x=(0,n.useRouter)(),[p,f]=(0,r.useState)([]),[j,g]=(0,r.useState)([]),[_,E]=(0,r.useState)(!0),[z,A]=(0,r.useState)([]),[P,L]=(0,r.useState)(!1),[O,F]=(0,r.useState)(""),[B,R]=(0,r.useState)(""),[U,H]=(0,r.useState)("staff"),[M,T]=(0,r.useState)(!1),[V,q]=(0,r.useState)(!1),[I,D]=(0,r.useState)(null),[$,J]=(0,r.useState)(""),[K,Y]=(0,r.useState)(!1),[Q,G]=(0,r.useState)(null),[X,W]=(0,r.useState)("");(0,r.useEffect)(()=>{s||e?s||!e||a()||x.push("/"):x.push("/login")},[e,s,x,a]),(0,r.useEffect)(()=>{e&&a()&&(ee(),es(),ea())},[e]);let ee=async()=>{try{let e=await fetch("".concat(C,"/auth/users"),{headers:(0,l.getAuthHeaders)()}),s=await e.json();s.success&&f(s.data)}catch(e){console.error("Failed to load users:",e)}finally{E(!1)}},es=async()=>{g(await (0,k.uc)())},ea=async()=>{try{let e=await fetch("".concat(C,"/auth/roles/creatable"),{headers:(0,l.getAuthHeaders)()}),s=await e.json();s.success&&(A(s.data),s.data.length>0&&H(s.data[s.data.length-1]))}catch(e){console.error("Failed to load creatable roles:",e)}},et=async e=>{e.preventDefault(),T(!0);try{let e=await fetch("".concat(C,"/auth/users"),{method:"POST",headers:{"Content-Type":"application/json",...(0,l.getAuthHeaders)()},body:JSON.stringify({username:O,password:B,role:U})}),s=await e.json();s.success?(L(!1),F(""),R(""),H(z[z.length-1]||"staff"),ee()):alert(s.error||"Failed to create user")}catch(e){console.error("Failed to create user:",e),alert("Failed to create user")}finally{T(!1)}},er=async e=>{if(confirm("Are you sure you want to delete this user?"))try{let s=await fetch("".concat(C,"/auth/users/").concat(e),{method:"DELETE",headers:(0,l.getAuthHeaders)()});if(s.ok)ee();else{let e=await s.json();alert(e.error||"Failed to delete user")}}catch(e){console.error("Failed to delete user:",e)}},en=s=>!!e&&s.id!==e.id&&Z[e.role]>Z[s.role],el=async()=>{if(I&&$)try{let e=await fetch("".concat(C,"/auth/users/").concat(I,"/entities"),{method:"POST",headers:{"Content-Type":"application/json",...(0,l.getAuthHeaders)()},body:JSON.stringify({entityId:$})});if(e.ok)q(!1),D(null),J(""),ee();else{let s=await e.json();alert(s.error||"Failed to assign entity")}}catch(e){console.error("Failed to assign entity:",e)}},ei=async(e,s)=>{try{(await fetch("".concat(C,"/auth/users/").concat(e,"/entities/").concat(s),{method:"DELETE",headers:(0,l.getAuthHeaders)()})).ok&&ee()}catch(e){console.error("Failed to unassign entity:",e)}},ec=async()=>{if(Q&&X)try{let e=await fetch("".concat(C,"/auth/users/").concat(Q,"/password"),{method:"PATCH",headers:{"Content-Type":"application/json",...(0,l.getAuthHeaders)()},body:JSON.stringify({password:X})});if(e.ok)Y(!1),G(null),W(""),alert("Password updated successfully");else{let s=await e.json();alert(s.error||"Failed to update password")}}catch(e){console.error("Failed to update password:",e)}},ed=e=>{let s=j.find(s=>s.id===e);return s?"".concat(s.emoji," ").concat(s.displayName):e};return s||!a()?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):(0,t.jsxs)("div",{className:"space-y-6 md:space-y-8",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm sm:text-base",children:"Create users and assign them to club entities"})]}),(0,t.jsxs)(h.Vq,{open:P,onOpenChange:L,children:[(0,t.jsx)(h.hg,{asChild:!0,children:(0,t.jsxs)(c.z,{className:"gap-2 w-full sm:w-auto",children:[(0,t.jsx)(y,{className:"h-4 w-4"}),"Create User"]})}),(0,t.jsxs)(h.cZ,{children:[(0,t.jsxs)(h.fK,{children:[(0,t.jsx)(h.$N,{children:"Create New User"}),(0,t.jsx)(h.Be,{children:"Create a new user account and assign a role."})]}),(0,t.jsxs)("form",{onSubmit:et,children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o._,{children:"Username"}),(0,t.jsx)(d.I,{value:O,onChange:e=>F(e.target.value),placeholder:"Enter username",required:!0})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o._,{children:"Password"}),(0,t.jsx)(d.I,{type:"password",value:B,onChange:e=>R(e.target.value),placeholder:"Enter password (min 4 characters)",minLength:4,required:!0})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o._,{children:"Role"}),(0,t.jsxs)(m.Ph,{value:U,onValueChange:e=>H(e),children:[(0,t.jsx)(m.i4,{children:(0,t.jsx)(m.ki,{placeholder:"Select a role"})}),(0,t.jsx)(m.Bw,{children:z.map(e=>(0,t.jsx)(m.Ql,{value:e,children:l.ROLE_LABELS[e]},e))})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["superuser"===U&&"Full access to all clubs and user management","club_owner"===U&&"Can edit club info and manage Event Managers & Staff","event_manager"===U&&"Can edit club info and manage Staff","staff"===U&&"Basic access to assigned clubs"]})]})]}),(0,t.jsx)(h.cN,{children:(0,t.jsx)(c.z,{type:"submit",disabled:M||0===z.length,children:M?"Creating...":"Create User"})})]})]})]})]}),_?(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading users..."}):0===p.length?(0,t.jsx)(i.Zb,{className:"p-6 sm:p-8 text-center",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"No users found."})}):(0,t.jsx)("div",{className:"grid gap-3 sm:gap-4",children:p.map(s=>(0,t.jsxs)(i.Zb,{children:[(0,t.jsxs)(i.Ol,{className:"pb-2 p-3 sm:p-6 sm:pb-2",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,t.jsxs)(i.ll,{className:"text-base sm:text-lg flex flex-wrap items-center gap-2",children:[s.username,(0,t.jsxs)(u.C,{variant:S[s.role].variant,className:"gap-1 text-xs",children:[S[s.role].icon,l.ROLE_LABELS[s.role]]})]}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(s.id===(null==e?void 0:e.id)||en(s))&&(0,t.jsxs)(c.z,{variant:"outline",size:"sm",className:"gap-1 text-xs sm:text-sm",onClick:()=>{G(s.id),Y(!0)},children:[(0,t.jsx)(N,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Password"})]}),en(s)&&(0,t.jsx)(c.z,{variant:"outline",size:"sm",className:"gap-1 text-red-500 hover:bg-red-500/10",onClick:()=>er(s.id),children:(0,t.jsx)(w.Z,{className:"h-4 w-4"})}),s.id===(null==e?void 0:e.id)&&(0,t.jsx)(u.C,{variant:"outline",className:"text-xs",children:"You"})]})]}),(0,t.jsxs)(i.SZ,{className:"text-xs sm:text-sm",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]}),(0,t.jsxs)(i.aY,{className:"p-3 pt-0 sm:p-6 sm:pt-0",children:["superuser"!==s.role&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o._,{children:"Assigned Entities:"}),en(s)&&(0,t.jsxs)(c.z,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{D(s.id),q(!0)},children:[(0,t.jsx)(v.Z,{className:"h-4 w-4"}),"Assign Entity"]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:0===s.assignedEntities.length?(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"No entities assigned"}):s.assignedEntities.map(e=>(0,t.jsxs)(u.C,{variant:"secondary",className:"gap-1 pr-1",children:[ed(e),en(s)&&(0,t.jsx)(c.z,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-destructive/20",onClick:()=>ei(s.id,e),children:(0,t.jsx)(b.Z,{className:"h-3 w-3"})})]},e))})]}),"superuser"===s.role&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Superusers have access to all entities"})]})]},s.id))}),(0,t.jsx)(h.Vq,{open:V,onOpenChange:q,children:(0,t.jsxs)(h.cZ,{children:[(0,t.jsxs)(h.fK,{children:[(0,t.jsx)(h.$N,{children:"Assign Entity"}),(0,t.jsx)(h.Be,{children:"Select an entity to assign to this user."})]}),(0,t.jsx)("div",{className:"py-4",children:(0,t.jsxs)(m.Ph,{value:$,onValueChange:J,children:[(0,t.jsx)(m.i4,{children:(0,t.jsx)(m.ki,{placeholder:"Select an entity"})}),(0,t.jsx)(m.Bw,{children:j.map(e=>(0,t.jsxs)(m.Ql,{value:e.id,children:[e.emoji," ",e.displayName]},e.id))})]})}),(0,t.jsx)(h.cN,{children:(0,t.jsx)(c.z,{onClick:el,disabled:!$,children:"Assign"})})]})}),(0,t.jsx)(h.Vq,{open:K,onOpenChange:Y,children:(0,t.jsxs)(h.cZ,{children:[(0,t.jsxs)(h.fK,{children:[(0,t.jsx)(h.$N,{children:"Update Password"}),(0,t.jsx)(h.Be,{children:"Enter a new password for this user."})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)(o._,{children:"New Password"}),(0,t.jsx)(d.I,{type:"password",value:X,onChange:e=>W(e.target.value),placeholder:"Enter new password (min 4 characters)",minLength:4})]}),(0,t.jsx)(h.cN,{children:(0,t.jsx)(c.z,{onClick:ec,disabled:X.length<4,children:"Update Password"})})]})})]})}},8137:function(e,s,a){"use strict";a.d(s,{Bw:function(){return p},Ph:function(){return o},Ql:function(){return f},i4:function(){return h},ki:function(){return u}});var t=a(7573),r=a(7653),n=a(9771),l=a(7216),i=a(8695),c=a(9375),d=a(3061);let o=n.fC;n.ZA;let u=n.B4,h=r.forwardRef((e,s)=>{let{className:a,children:r,...i}=e;return(0,t.jsxs)(n.xz,{ref:s,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[r,(0,t.jsx)(n.JO,{asChild:!0,children:(0,t.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=n.xz.displayName;let m=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.u_,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(i.Z,{className:"h-4 w-4"})})});m.displayName=n.u_.displayName;let x=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.$G,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=n.$G.displayName;let p=r.forwardRef((e,s)=>{let{className:a,children:r,position:l="popper",...i}=e;return(0,t.jsx)(n.h_,{children:(0,t.jsxs)(n.VY,{ref:s,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...i,children:[(0,t.jsx)(m,{}),(0,t.jsx)(n.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(x,{})]})})});p.displayName=n.VY.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.__,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=n.__.displayName;let f=r.forwardRef((e,s)=>{let{className:a,children:r,...l}=e;return(0,t.jsxs)(n.ck,{ref:s,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(n.wU,{children:(0,t.jsx)(c.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(n.eT,{children:r})]})});f.displayName=n.ck.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(n.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=n.Z0.displayName}},function(e){e.O(0,[801,136,831,284,540,293,16,744],function(){return e(e.s=8058)}),_N_E=e.O()}]);